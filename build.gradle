/*
 * This build file was auto generated by running the Gradle 'buildSetup' task
 * by 'wfuller' at '11/11/13 11:12 AM' with Gradle 1.7
 *
 * This generated file contains a commented-out sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at http://gradle.org/docs/1.7/userguide/tutorial_java_projects.html
 */


apply plugin: 'base' // To add "clean" task to the root project.
apply plugin: 'war'


sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
    mavenCentral()
    maven {
        url "https://bbprepo.blackboard.com/content/repositories/releases/"
    }
}
configurations {
    b2deploy
}

if (isBuildingBlock()) {
  version = getB2Version()
}

dependencies {

    testCompile group: 'junit', name: 'junit', version: '4.10'
//    testCompile group: 'org.jbehave', name: 'jbehave-core', version: '3.8'
//    testCompile group: 'org.apache.httpcomponents', name: 'httpclient', version: '4.3-beta1'

    b2deploy 'org.oscelot:b2deploy-task:0.1.0'
    providedCompile 'blackboard.platform:bb-platform:9.1.100401.0'
    providedCompile 'blackboard.platform:bb-cms-admin:9.1.100401.0'
    providedCompile 'blackboard.platform:bb-taglibs:9.1.100401.0'
//    compile files('lib/bb-platform-9.1.14', 'lib/bb-taglibs-9.1.14', 'lib/bb-cms-admin-9.1.14')
//  providedCompile fileTree(dir: 'lib', include: '*.jar')
    providedCompile 'blackboard.platform:bb-ws-gradebook:9.1.100401.0'
    
//    providedCompile group: 'org.apache.httpcomponents', name: 'httpclient', version: '4.3-beta1'
    providedCompile 'commons-codec:commons-codec:1.3'
    providedCompile 'commons-io:commons-io:1.4'
    providedCompile 'commons-lang:commons-lang:2.4'
    providedCompile 'org.apache.velocity:velocity:1.5'
    
    providedCompile 'javax.servlet:servlet-api:2.5'
    providedCompile 'jstl:jstl:1.2'
    providedCompile 'javax.activation:activation:1.1'

    compile ('net.sourceforge.stripes:stripes:1.5.7') {
        exclude group: 'commons-logging'
    }

    compile 'org.springframework:spring-beans:4.3.0.RELEASE'
    compile 'org.springframework:spring-web:4.3.0.RELEASE'

    compile 'org.slf4j:slf4j-api:1.7.5'
    compile 'org.slf4j:jul-to-slf4j:1.7.5'
    compile 'ch.qos.logback:logback-classic:1.1.3'
    compile 'org.slf4j:log4j-over-slf4j:1.7.21'

    compile files('lib/b2-logging-utils-1.0.0.jar')


}

ant.taskdef(name: 'b2deploy', classname: 'org.oscelot.ant.B2DeployTask', classpath: configurations.b2deploy.asPath)

task deployb2(dependsOn: 'war') << {
    println "Deploying \"" + war.archivePath + "\""
    ant.b2deploy(localfilepath: war.archivePath,
        host: 'localhost:9876',
        clean: 'true',
        courseorgavailable:'true')
}


String getB2Version() {
  File mfFile = new File(file(webAppDir), 'WEB-INF/bb-manifest.xml');
  def manifest = new XmlSlurper().parse(mfFile);
  return manifest.plugin.version['@value'];
}

boolean isBuildingBlock() {
  File mfFile = new File(file(webAppDir), 'WEB-INF/bb-manifest.xml');
  return mfFile.exists();
}